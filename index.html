<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>SAWA Mining</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  background:#0b0b1e;
  color:white;
  font-family:Segoe UI, sans-serif;
  margin:0; padding-bottom:80px;
}
.card {
  background:#16163a;
  padding:15px;
  border-radius:14px;
  margin:12px;
}
button {
  padding:12px;
  border:none;
  border-radius:12px;
  background:#6c63ff;
  color:white;
  font-weight:bold;
  cursor:pointer;
}
button:disabled {opacity:.4; cursor:not-allowed;}
.nav {
  position:fixed; bottom:0; width:100%;
  display:flex; justify-content:space-around; background:#111; padding:10px 0;
}
.hidden {display:none;}
.progress {background:#222; border-radius:10px; height:12px; overflow:hidden; margin-top:5px;}
.bar {background:linear-gradient(90deg,#f39c12,#f1c40f); height:100%; width:0;}
.badge {
  display:inline-block;
  background:#2ecc71;
  padding:3px 8px;
  border-radius:10px;
  font-size:.7rem;
  margin-left:5px;
}
.plus-one {
  position:absolute; font-weight:bold; color:#f39c12; font-size:24px;
  animation: floatUp 0.8s forwards; pointer-events:none;
}
@keyframes floatUp {0% {opacity:1; transform:translateY(0);} 100% {opacity:0; transform:translateY(-100px);}}
</style>
</head>

<body>

<!-- MINING -->
<div class="card" id="mineView">
  <h2>â›ï¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ†</h2>
  <p>ğŸ’° Ø§Ù„Ø±ØµÙŠØ¯: <b id="balance">0</b></p>
  <p>â­ Ø§Ù„Ù†Ù‚Ø§Ø·: <b id="points">0</b></p>
  âš¡ Ø§Ù„Ø·Ø§Ù‚Ø©: <span id="energy">0</span>/1000
  <div class="progress"><div class="bar" id="energyBar"></div></div>
  <br>
  <button onclick="mine()" id="mineBtn">Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¹Ø¯ÙŠÙ†</button>
</div>

<!-- STORE -->
<div class="card hidden" id="storeView">
  <h3>ğŸ›’ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ©</h3>
  <p>ğŸ¥‰ Bronze Card â€“ Ø¹Ù†Ø¯ 50 Ù†Ù‚Ø·Ø© <span id="bronzeStatus"></span></p>
  <p>ğŸ¥ˆ Silver Card â€“ Ø¹Ù†Ø¯ 100 Ù†Ù‚Ø·Ø© <span id="silverStatus"></span></p>
  <p>ğŸ¥‡ Gold Card â€“ Ø¹Ù†Ø¯ 1000 Ù†Ù‚Ø·Ø© <span id="goldStatus"></span></p>
  <p>ğŸª Platinum Card â€“ Ø¹Ù†Ø¯ 5000 Ù†Ù‚Ø·Ø© <span id="platinumStatus"></span></p>
</div>

<!-- TASKS -->
<div class="card hidden" id="tasksView">
  <h3>ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
  <p>1ï¸âƒ£ Ø§Ø´ØªØ±Ùƒ ÙÙŠ Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… â€“ +500 Ù†Ù‚Ø·Ø© <button onclick="completeTask('telegram')">Ø§ÙƒÙ…Ù„</button></p>
  <p>2ï¸âƒ£ ØªØ§Ø¨Ø¹ Ø­Ø³Ø§Ø¨ ØªÙˆÙŠØªØ± â€“ +500 Ù†Ù‚Ø·Ø© <button onclick="completeTask('twitter')">Ø§ÙƒÙ…Ù„</button></p>
  <p>3ï¸âƒ£ Ø¯Ø¹ÙˆØ© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ â€“ +10% Ù…Ù† ØªØ¹Ø¯ÙŠÙ†Ù‡Ù… <button onclick="completeTask('invite')">Ø§ÙƒÙ…Ù„</button></p>
</div>

<!-- PROFILE -->
<div class="card hidden" id="profileView">
  <h3>ğŸ‘¤ Ø­Ø³Ø§Ø¨ÙŠ</h3>
  <p>ğŸ†” ID: <b id="uid"></b></p>
  <p>ğŸ–ï¸ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: <b id="card"></b></p>
  <p>âš¡ Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ†: <b id="speed"></b></p>
</div>

<!-- NAV -->
<div class="nav">
  <button onclick="show('mineView')">â›ï¸ ØªØ¹Ø¯ÙŠÙ†</button>
  <button onclick="show('storeView')">ğŸ›’ Ù…ØªØ¬Ø±</button>
  <button onclick="show('tasksView')">ğŸ“‹ Ù…Ù‡Ø§Ù…</button>
  <button onclick="show('profileView')">ğŸ‘¤ Ø­Ø³Ø§Ø¨</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const API = "https://Naser090.pythonanywhere.com";
const user = tg.initDataUnsafe.user || {id:123456};

document.getElementById("uid").innerText = user.id;

function show(id){
  document.querySelectorAll(".card").forEach(c=>c.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
}

// --- PLUS ONE EFFECT ---
function plusOne(x, y){
  const p = document.createElement('div');
  p.className='plus-one';
  p.innerText='+1';
  p.style.left = x+'px';
  p.style.top = y+'px';
  document.body.appendChild(p);
  setTimeout(()=>p.remove(),800);
}

// --- LOAD USER DATA ---
async function loadUser(){
  const r = await fetch(`${API}/user/init/${user.id}`);
  const d = await r.json();
  updateUI(d);
}

// --- UPDATE UI ---
function updateUI(d){
  balance.innerText = d.balance;
  points.innerText = d.balance;
  energy.innerText = d.energy;
  energyBar.style.width = (d.energy/1000*100)+"%";
  card.innerText = d.card || d.level;
  speed.innerText = "x"+(d.speed || 1);

  bronzeStatus.innerHTML = d.balance>=50?"<span class='badge'>Ù…ÙØ¹Ù„Ø©</span>":"";
  silverStatus.innerHTML = d.balance>=100?"<span class='badge'>Ù…ÙØ¹Ù„Ø©</span>":"";
  goldStatus.innerHTML   = d.balance>=1000?"<span class='badge'>Ù…ÙØ¹Ù„Ø©</span>":"";
  platinumStatus.innerHTML=d.balance>=5000?"<span class='badge'>Ù…ÙØ¹Ù„Ø©</span>":"";

  mineBtn.disabled = d.energy < 2;
}

// --- MINE FUNCTION ---
async function mine(e){
  if(e) plusOne(e.clientX||0,e.clientY||0);
  const r = await fetch(`${API}/mine?user_id=${user.id}`,{method:"POST"});
  const d = await r.json();
  if(!d.error){
    updateUI(d);
    tg.HapticFeedback.impactOccurred("medium");
  }
}

// --- COMPLETE TASK ---
async function completeTask(task){
  // Ù‡Ù†Ø§ ØªØ±Ø¨Ø· Ù…Ø¹ API Ù„Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ù†Ù‚Ø§Ø· Ø¹Ù†Ø¯ Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø©
  alert("ØªÙ… Ø§ØªÙ…Ø§Ù… Ø§Ù„Ù…Ù‡Ù…Ø©: "+task+" (ÙŠÙ…ÙƒÙ† Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯)");
}

// --- INIT ---
loadUser();
setInterval(loadUser,10000);
</script>

</body>
</html>
