<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nurzao Mining</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
:root {
  --bg:#0a0a14;
  --glass:rgba(255,255,255,0.08);
  --border:rgba(255,255,255,0.15);
  --gold:#f5c542;
  --blue:#00d2ff;
}

body{
  margin:0;
  background:radial-gradient(circle,#1b1b3a,#05050c);
  font-family:Segoe UI,Roboto;
  color:#fff;
}

.card{
  background:var(--glass);
  border:1px solid var(--border);
  border-radius:22px;
  padding:15px;
  margin:12px;
  backdrop-filter:blur(15px);
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.avatar{
  width:46px;
  height:46px;
  border-radius:50%;
  border:2px solid var(--blue);
}

.balance{
  font-size:1.8rem;
  color:var(--gold);
  font-weight:900;
}

.center{
  text-align:center;
  margin-top:20px;
}

.mine-btn img{
  width:240px;
  filter:drop-shadow(0 0 30px var(--gold));
  transition:0.1s;
}
.mine-btn:active img{transform:scale(.9);}

.progress{
  height:14px;
  background:#111;
  border-radius:10px;
  overflow:hidden;
  margin-top:8px;
}
.bar{
  height:100%;
  background:linear-gradient(90deg,#f39c12,#f1c40f);
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin-top:12px;
}

.stat{
  text-align:center;
  font-size:.75rem;
  color:#aaa;
}
.stat b{
  display:block;
  color:#fff;
  font-size:.9rem;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="card header">
  <div style="display:flex;gap:10px;align-items:center">
    <img id="avatar" class="avatar">
    <div>
      <div id="username">...</div>
      <small id="level">Spark</small>
    </div>
  </div>
  <div class="balance" id="balance">0</div>
</div>

<!-- MINING -->
<div class="center">
  <button class="mine-btn" id="mine">
    <img src="https://img.icons8.com/fluency/240/gold-bars.png">
  </button>
</div>

<!-- INFO -->
<div class="card">
  ⚡ الطاقة: <span id="energyText">0</span>/1000
  <div class="progress">
    <div class="bar" id="energyBar"></div>
  </div>

  <div class="grid">
    <div class="stat">النقاط<b id="points">0</b></div>
    <div class="stat">البطاقة<b id="card">Basic</b></div>
    <div class="stat">السرعة<b id="speed">x1</b></div>
    <div class="stat">ID<b id="uid">---</b></div>
  </div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const API = "https://Naser090.pythonanywhere.com";
const user = tg.initDataUnsafe.user || {id:999, first_name:"Guest"};

document.getElementById("username").innerText = user.first_name;
document.getElementById("uid").innerText = user.id;
document.getElementById("avatar").src =
  user.photo_url || `https://ui-avatars.com/api/?name=${user.first_name}`;

async function init(){
  const r = await fetch(`${API}/user/init/${user.id}`);
  const d = await r.json();
  update(d);
}

function update(d){
  balance.innerText = d.balance;
  level.innerText = d.level;
  energyText.innerText = d.energy;
  points.innerText = d.points;
  card.innerText = d.card.toUpperCase();
  speed.innerText = "x" + d.speed;

  energyBar.style.width = (d.energy/1000*100)+"%";
}

mine.onclick = async ()=>{
  const r = await fetch(`${API}/mine?user_id=${user.id}`,{method:"POST"});
  const d = await r.json();
  if(!d.error) update(d);
  tg.HapticFeedback.impactOccurred("medium");
}

init();
</script>

</body>
</html>
