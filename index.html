<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nurzao | Ù‚ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø§Ù„Ù…</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<style>
:root {
  --neon-gold: #ffcf4d;
  --neon-blue: #00f2ff;
  --deep-bg: #050508;
  --glass: rgba(255,255,255,0.05);
  --border: rgba(255,255,255,0.1);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
  margin:0; font-family:'Segoe UI',sans-serif; color:white;
  background: var(--deep-bg); display:flex; flex-direction:column; height:100vh; overflow:hidden;
}

/* Header */
.header {
  padding:15px 20px; background:var(--glass); backdrop-filter:blur(15px);
  border-bottom:1px solid var(--border); display:flex; justify-content:space-between; align-items:center;
}
.user-pill { display:flex; align-items:center; gap:10px; background:rgba(0,0,0,0.3); padding:5px 15px; border-radius:50px; border:1px solid var(--neon-blue);}
.user-pill img { width:30px; height:30px; border-radius:50%; }
#balance { font-size:2rem; font-weight:900; color:var(--neon-gold); text-shadow:0 0 20px rgba(255,207,77,0.4); }

/* Views */
.view-container { flex-grow:1; padding:20px; overflow-y:auto; display:none; flex-direction:column; transition:0.3s; }
.active-view { display:flex; animation:slideUp 0.4s ease-out; }
@keyframes slideUp { from { transform: translateY(20px); opacity:0;} to { transform: translateY(0); opacity:1;} }

/* Mining */
.mine-circle { width:280px; height:280px; margin:auto; position:relative; display:flex; justify-content:center; align-items:center;}
.coin-shadow { position:absolute; width:100%; height:100%; border-radius:50%; background:var(--neon-gold); filter:blur(60px); opacity:0.1;}
.coin-btn { background:none; border:none; cursor:pointer; z-index:5; transition:0.1s;}
.coin-btn img { width:240px; animation:pulse 3s infinite; }
.coin-btn:active { transform:scale(0.92);}
@keyframes pulse { 0%,100%{transform:scale(1);} 50%{transform:scale(1.05);}}

/* Cards and Tasks */
.card { background:var(--glass); border:1px solid var(--border); border-radius:20px; padding:20px; margin-bottom:15px;}
.task-item { display:flex; justify-content:space-between; align-items:center; margin-top:10px; padding:10px; background:rgba(255,255,255,0.03); border-radius:12px; }

/* Energy Bar */
.energy-section { padding:0 20px 20px; }
.energy-bar-bg { height:12px; background:#111; border-radius:10px; border:1px solid var(--border); overflow:hidden; }
#energy-fill { height:100%; width:100%; background:linear-gradient(90deg,var(--neon-gold),#fff); transition:0.3s; }

/* Nav */
.nav-bar {
  background:rgba(0,0,0,0.9); backdrop-filter:blur(20px);
  border-top:1px solid var(--border); display:grid; grid-template-columns:repeat(4,1fr);
  padding:15px 0 30px;
}
.nav-item { text-align:center; color:#666; cursor:pointer; transition:0.3s; }
.nav-item.active-nav { color:var(--neon-blue); text-shadow:0 0 10px var(--neon-blue);}
.nav-item i { font-size:1.4rem; display:block; margin-bottom:5px; }

/* Floating +1 effect */
.plus-one { position:absolute; font-weight:bold; color:var(--neon-gold); font-size:24px; animation:floatUp 0.8s forwards; pointer-events:none; }
@keyframes floatUp {0%{opacity:1; transform:translateY(0);} 100%{opacity:0; transform:translateY(-100px);}}
.badge { display:inline-block; background:#2ecc71; padding:3px 8px; border-radius:10px; font-size:.7rem; margin-left:5px;}
</style>
</head>
<body>

<div class="header">
  <div class="user-pill">
    <img id="u-photo" src="https://ui-avatars.com/api/?name=User">
    <span id="u-name">ØªØ­Ù…ÙŠÙ„...</span>
  </div>
  <div id="balance">0</div>
</div>

<!-- Mining View -->
<div id="mine-v" class="view-container active-view">
  <div class="mine-circle">
    <div class="coin-shadow"></div>
    <button class="coin-btn" id="tap-btn">
      <img src="https://img.icons8.com/fluency/240/gold-bars.png">
    </button>
  </div>
  <div class="energy-section">
    <div style="display:flex; justify-content:space-between; margin-bottom:8px; font-size:0.9rem;">
      <span>âš¡ Ø§Ù„Ø·Ø§Ù‚Ø©: <span id="e-val">0</span>/1000</span>
      <span style="color:var(--neon-blue)">Ø±ØªØ¨ØªÙŠ: Global</span>
    </div>
    <div class="energy-bar-bg"><div id="energy-fill"></div></div>
  </div>
</div>

<!-- Tasks View -->
<div id="tasks-v" class="view-container">
  <h2>ğŸ“‹ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h2>
  <div class="card task-item">
    <div>
      <b>Ù‚Ù†Ø§Ø© Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ø±Ø³Ù…ÙŠØ©</b><br>
      <small style="color:#888;">Ø§Ø´ØªØ±Ùƒ Ù„Ù„Ù‚ÙŠÙ…Ø© +500</small>
    </div>
    <button onclick="completeTask('telegram')">Ø§ÙƒÙ…Ù„</button>
  </div>
  <div class="card task-item">
    <div>
      <b>ØªØ§Ø¨Ø¹ ØªÙˆÙŠØªØ±</b><br>
      <small style="color:#888;">ØªØ§Ø¨Ø¹ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Ù‚Ø§Ø·</small>
    </div>
    <button onclick="completeTask('twitter')">Ø§ÙƒÙ…Ù„</button>
  </div>
  <div class="card task-item">
    <div>
      <b>Ø¯Ø¹ÙˆØ© ØµØ¯ÙŠÙ‚</b><br>
      <small style="color:#888;">ÙƒÙ„ ØµØ¯ÙŠÙ‚ ÙŠØ²ÙŠØ¯ Ù‚ÙˆØªÙƒ +10%</small>
    </div>
    <button onclick="completeTask('invite')">Ø§ÙƒÙ…Ù„</button>
  </div>
</div>

<!-- Store View -->
<div id="store-v" class="view-container">
  <h2>ğŸ›’ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª</h2>
  <div class="card">ğŸ¥‰ Bronze Card â€“ 50 Ù†Ù‚Ø§Ø· <span id="bronzeStatus"></span></div>
  <div class="card">ğŸ¥ˆ Silver Card â€“ 100 Ù†Ù‚Ø§Ø· <span id="silverStatus"></span></div>
  <div class="card">ğŸ¥‡ Gold Card â€“ 1000 Ù†Ù‚Ø§Ø· <span id="goldStatus"></span></div>
  <div class="card">ğŸª Platinum Card â€“ 5000 Ù†Ù‚Ø§Ø· <span id="platinumStatus"></span></div>
</div>

<!-- Profile View -->
<div id="profile-v" class="view-container">
  <h2>ğŸ‘¤ Ù…Ù„ÙÙŠ Ø§Ù„Ø´Ø®ØµÙŠ</h2>
  <div class="card">
    ğŸ†” ID: <span id="p-id">...</span><br>
    ğŸ–ï¸ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©: <span id="card"></span><br>
    âš¡ Ø³Ø±Ø¹Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ†: <span id="speed"></span>
  </div>
</div>

<!-- Nav -->
<div class="nav-bar">
  <div class="nav-item active-nav" onclick="showTab('mine-v', this)"><i class="fas fa-bolt"></i>ØªØ¹Ø¯ÙŠÙ†</div>
  <div class="nav-item" onclick="showTab('tasks-v', this)"><i class="fas fa-shield-halved"></i>Ø§Ù„Ù…Ù‡Ø§Ù…</div>
  <div class="nav-item" onclick="showTab('store-v', this)"><i class="fas fa-crown"></i>Ø§Ù„Ù…ØªØ¬Ø±</div>
  <div class="nav-item" onclick="showTab('profile-v', this)"><i class="fas fa-user-gear"></i>Ù…Ù„ÙÙŠ</div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const API = "https://Naser090.pythonanywhere.com";
const user = tg.initDataUnsafe.user || { id: 123456, first_name:"Ø§Ù„Ù‚Ø§Ø¦Ø¯", photo_url:null };

let balance=0, energy=1000;

// Init
document.getElementById('u-name').innerText = user.first_name;
document.getElementById('p-id').innerText = user.id;
if(user.photo_url) document.getElementById('u-photo').src = user.photo_url;

// Show view
function showTab(id, el){
  document.querySelectorAll('.view-container').forEach(v=>v.classList.remove('active-view'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active-nav'));
  document.getElementById(id).classList.add('active-view');
  el.classList.add('active-nav');
}

// Floating +1
function plusOne(x,y){
  const p=document.createElement('div');
  p.className='plus-one';
  p.innerText='+1';
  p.style.left=x+'px';
  p.style.top=y+'px';
  document.body.appendChild(p);
  setTimeout(()=>p.remove(),800);
}

// Update UI
function updateUI(d){
  balance=d.balance; energy=d.energy;
  document.getElementById('balance').innerText = balance.toLocaleString();
  document.getElementById('e-val').innerText = energy;
  document.getElementById('energy-fill').style.width = (energy/1000*100)+'%';
  document.getElementById('card').innerText = d.card||d.level;
  document.getElementById('speed').innerText = 'x'+(d.speed||1);
  bronzeStatus.innerHTML = d.balance>=50?"<span class='badge'>Ù…ÙØ¹Ù„Ø©</span>":"";
  silverStatus.innerHTML = d.balance>=100?"<span class='badge'>Ù…ÙØ¹Ù„Ø©</span>":"";
  goldStatus.innerHTML = d.balance>=1000?"<span class='badge'>Ù…ÙØ¹Ù„Ø©</span>":"";
  platinumStatus.innerHTML=d.balance>=5000?"<span class='badge'>Ù…ÙØ¹Ù„Ø©</span>":"";
  document.getElementById('mineBtn')?.setAttribute('disabled', energy<2);
}

// Load user
async function loadUser(){
  const r=await fetch(`${API}/user/init/${user.id}`);
  const d=await r.json();
  updateUI(d);
}

// Mining click
document.getElementById('tap-btn').addEventListener('touchstart',async(e)=>{
  if(energy>=2){
    const r=await fetch(`${API}/mine?user_id=${user.id}`,{method:'POST'});
    const d=await r.json();
    if(!d.error){
      updateUI(d);
      plusOne(e.touches[0].clientX, e.touches[0].clientY);
      tg.HapticFeedback.impactOccurred('medium');
    }
  }
});

// Complete Task
async function completeTask(task){
  const r=await fetch(`${API}/task/complete?user_id=${user.id}&task=${task}`,{method:'POST'});
  const d=await r.json();
  if(d.success) { loadUser(); tg.showAlert("ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ù…Ù‡Ù…Ø©!"); }
}

// Auto refresh every 10s
loadUser();
setInterval(loadUser,10000);
</script>

</body>
  </html>
